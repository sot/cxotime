<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>cxotime.cxotime &#8212; cxotime 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-astropy.css?v=f4f7060c" />
    
    <script src="../../_static/documentation_options.js?v=2709fde1"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../index.html"><span id="logotext1">Ska!</span><span id="logotext2">CXO</span><span id="logotext3">Time</span></a>
  <ul>
    
    <li><a class="home" title="Homepage" href="https://cxc.cfa.harvard.edu/mta/ASPECT/tool_doc">
        <span id="logotext1">ska</span><span id="logotext2">tools</span>
    </a></li>
    <li><a title="General Index" href="../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../index.html">cxotime 0.1 documentation</a>
	 &#187;
      </li>
      <li><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for cxotime.cxotime</h1><div class="highlight"><pre>
<span></span><span class="c1"># Licensed under a 3-clause BSD style license - see LICENSE.rst</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">erfa</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.typing</span> <span class="k">as</span> <span class="nn">npt</span>
<span class="kn">from</span> <span class="nn">astropy.time</span> <span class="kn">import</span> <span class="n">Time</span><span class="p">,</span> <span class="n">TimeCxcSec</span><span class="p">,</span> <span class="n">TimeDecimalYear</span><span class="p">,</span> <span class="n">TimeJD</span><span class="p">,</span> <span class="n">TimeYearDayTime</span>
<span class="kn">from</span> <span class="nn">astropy.utils</span> <span class="kn">import</span> <span class="n">iers</span>
<span class="kn">from</span> <span class="nn">ska_helpers.utils</span> <span class="kn">import</span> <span class="n">TypedDescriptor</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CxoTime&quot;</span><span class="p">,</span> <span class="s2">&quot;CxoTimeLike&quot;</span><span class="p">,</span> <span class="s2">&quot;CxoTimeDescriptor&quot;</span><span class="p">]</span>


<span class="c1"># TODO: use npt.NDArray with numpy 1.21</span>
<span class="n">CxoTimeLike</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;CxoTime&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

<span class="c1"># Globally ignore the ERFA dubious year warning that gets emitted for UTC dates</span>
<span class="c1"># either before around 1950 or well after the last known leap second. This</span>
<span class="c1"># warning is conservatively indicating that UTC is not well-defined in those</span>
<span class="c1"># regimes, but we don&#39;t care.</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">erfa</span><span class="o">.</span><span class="n">ErfaWarning</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;.*dubious year&quot;</span><span class="p">)</span>

<span class="c1"># For working in Chandra operations, possibly with no network access, we cannot</span>
<span class="c1"># allow auto downloads.</span>
<span class="n">iers</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">auto_download</span> <span class="o">=</span> <span class="kc">False</span>


<div class="viewcode-block" id="CxoTime">
<a class="viewcode-back" href="../../index.html#cxotime.cxotime.CxoTime">[docs]</a>
<span class="k">class</span> <span class="nc">CxoTime</span><span class="p">(</span><span class="n">Time</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Time class for Chandra analysis that is based on ``astropy.time.Time``.</span>

<span class="sd">    The CXO-specific time formats which are added to the astropy ``Time`` class</span>
<span class="sd">    are shown in the table below.  Like ``DateTime``, the ``CxoTime`` class</span>
<span class="sd">    default is to interpret any numerical values as ``secs`` (aka ``cxcsec`` in</span>
<span class="sd">    the native ``Time`` class).</span>

<span class="sd">    All of these formats use the UTC scale.</span>

<span class="sd">    ========= ==============================================</span>
<span class="sd">     Format   Description</span>
<span class="sd">    ========= ==============================================</span>
<span class="sd">    secs      Seconds since 1998-01-01T00:00:00 (TT) (float)</span>
<span class="sd">    date      YYYY:DDD:hh:mm:ss.ss.. (string)</span>
<span class="sd">    frac_year YYYY.ffffff = date as a floating point year</span>
<span class="sd">    greta     YYYYDDD.hhmmsss (string)</span>
<span class="sd">    muade     YYYDDDhhmmsss (integer)</span>
<span class="sd">    ========= ==============================================</span>

<span class="sd">    Important differences:</span>

<span class="sd">    - In ``CxoTime`` the date &#39;2000:001&#39; is &#39;2000:001:00:00:00&#39; instead of</span>
<span class="sd">      &#39;2000:001:12:00:00&#39; in ``DateTime``.  In most cases this interpretation</span>
<span class="sd">      is more rational and expected.</span>

<span class="sd">    - In ``CxoTime`` the date &#39;2001-01-01T00:00:00&#39; is UTC by default, while in</span>
<span class="sd">      ``DateTime`` that is interpreted as TT by default.  This is triggered by</span>
<span class="sd">      the ``T`` in the middle.  A date like &#39;2001-01-01 00:00:00&#39; defaults</span>
<span class="sd">      to UTC in both ``CxoTime`` and ``DateTime``.</span>

<span class="sd">    The standard built-in Time formats that are available in ``CxoTime`` are:</span>

<span class="sd">    ===========  ==============================</span>
<span class="sd">    Format       Example</span>
<span class="sd">    ===========  ==============================</span>
<span class="sd">    byear        1950.0</span>
<span class="sd">    byear_str    &#39;B1950.0&#39;</span>
<span class="sd">    cxcsec       63072064.184</span>
<span class="sd">    datetime     datetime(2000, 1, 2, 12, 0, 0)</span>
<span class="sd">    decimalyear  2000.45</span>
<span class="sd">    fits         &#39;2000-01-01T00:00:00.000(TAI)&#39;</span>
<span class="sd">    gps          630720013.0</span>
<span class="sd">    iso          &#39;2000-01-01 00:00:00.000&#39;</span>
<span class="sd">    isot         &#39;2000-01-01T00:00:00.000&#39;</span>
<span class="sd">    jd           2451544.5</span>
<span class="sd">    jyear        2000.0</span>
<span class="sd">    jyear_str    &#39;J2000.0&#39;</span>
<span class="sd">    mjd          51544.0</span>
<span class="sd">    plot_date    730120.0003703703</span>
<span class="sd">    unix         946684800.0</span>
<span class="sd">    yday         2000:001:00:00:00.000</span>
<span class="sd">    ===========  ==============================</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Sentinel object for CxoTime(CxoTime.NOW) to return the current time. See e.g.</span>
    <span class="c1"># https://python-patterns.guide/python/sentinel-object/.</span>
    <span class="n">NOW</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Handle the case of `CxoTime()`, `CxoTime(None)`, or `CxoTime(CxoTime.NOW)`,</span>
        <span class="c1"># all of which return the current time. This is for compatibility with DateTime.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="n">CxoTime</span><span class="o">.</span><span class="n">NOW</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="c1"># Stub in a value for `val` so super()__new__ can run since `val`</span>
                <span class="c1"># is a required positional arg. NOTE that this change to args here does</span>
                <span class="c1"># not affect the args in the call to __init__() below.</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cannot supply keyword arguments with no time value&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">CxoTime</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c1"># If input is already a CxoTime instance and no other kwargs just return</span>
            <span class="c1"># the instance. Note that copy=False is the default.</span>
            <span class="k">return</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">CxoTime</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c1"># If input is already a CxoTime instance and no other kwargs (which</span>
            <span class="c1"># implies copy=False) then no other initialization is needed.</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="n">CxoTime</span><span class="o">.</span><span class="n">NOW</span><span class="p">):</span>
            <span class="c1"># Compatibility with DateTime and allows kwarg default of None with</span>
            <span class="c1"># input casting like `date = CxoTime(date)`.</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">()</span>

        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;DateTime&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;only one positional arg when DateTime is supplied&quot;</span>
                    <span class="p">)</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">,)</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;utc&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;utc&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;must use scale &#39;utc&#39; for DateTime input&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;must use format &#39;date&#39; for DateTime input&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># For `CxoTime()`` return the current time in `date` format.</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">Time</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">yday</span><span class="p">,)</span>

        <span class="c1"># If format is supplied and is a DateTime format then require scale=&#39;utc&#39;.</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">)</span>

        <span class="c1"># Define special formats for guessing and type of accepted vals</span>
        <span class="n">fmts_datetime</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;greta&quot;</span><span class="p">,</span> <span class="s2">&quot;secs&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;maude&quot;</span><span class="p">)</span>
        <span class="n">fmt_dtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">character</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">character</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">character</span><span class="p">)</span>

        <span class="c1"># Check that scale=UTC for special formats</span>
        <span class="k">if</span> <span class="n">fmt</span> <span class="ow">in</span> <span class="n">fmts_datetime</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;utc&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;utc&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;must use scale &#39;utc&#39; for format &#39;</span><span class="si">{</span><span class="n">fmt</span><span class="si">}</span><span class="s2">&#39;&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># If format is not supplied and one arg (val) supplied then guess format</span>
        <span class="c1"># in DateTime-compatibility mode. That means forcing scale to UTC.</span>
        <span class="k">if</span> <span class="n">fmt</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">kwargs_orig</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;utc&quot;</span>
            <span class="c1"># Do not make a copy unless specifically set by user</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="c1"># Convert to np.array at this point to get dtype</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_dtype</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">fmts_datetime</span><span class="p">,</span> <span class="n">fmt_dtypes</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">fmt_dtype</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fmt</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">super</span><span class="p">(</span><span class="n">CxoTime</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">kwargs_orig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;utc&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;utc&quot;</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;must use scale &#39;utc&#39; for format &#39;</span><span class="si">{</span><span class="n">fmt</span><span class="si">}</span><span class="s2">&#39;&#39;&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs_orig</span>

        <span class="k">elif</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s2">&quot;maude&quot;</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;S&quot;</span><span class="p">),)</span> <span class="o">+</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">CxoTime</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="CxoTime.linspace">
<a class="viewcode-back" href="../../index.html#cxotime.cxotime.CxoTime.linspace">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">linspace</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="n">CxoTimeLike</span><span class="p">,</span>
        <span class="n">stop</span><span class="p">:</span> <span class="n">CxoTimeLike</span><span class="p">,</span>
        <span class="n">num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">step_max</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a uniform time series that covers the given time range.</span>

<span class="sd">        Output times either divide the time range into ``num`` intervals or are</span>
<span class="sd">        uniformly spaced by up to ``step_max``, and cover the time</span>
<span class="sd">        range from ``start`` to ``stop``.</span>

<span class="sd">        Note that returned intervals may be larger than ``step_max`` by floating point error.</span>
<span class="sd">        If calling code requires that all the intervals be less than a value, ``step_max`` should</span>
<span class="sd">        be set to a value at least slightly smaller than the desired maximum value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start : CxoTimeLike</span>
<span class="sd">            Start time of the time range.</span>
<span class="sd">        stop : CxoTimeLike</span>
<span class="sd">            Stop time of the time range.</span>
<span class="sd">        num : int | None</span>
<span class="sd">            Number of time bins.</span>
<span class="sd">        step_max : u.Quantity (timelike)</span>
<span class="sd">            Maximum time interval step. Should be positive nonzero.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CxoTime</span>
<span class="sd">            CxoTime with time bin edges for each interval.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">CxoTime</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">CxoTime</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">num</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">step_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;exactly one of num and step_max must be defined&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">step_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Require that step_max is positive nonzero</span>
            <span class="k">if</span> <span class="n">step_max</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;step_max must be positive nonzero&quot;</span><span class="p">)</span>

            <span class="c1"># Calculate chunks to cover time range, handling edge case of start == stop</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">((</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="n">step_max</span><span class="p">))),</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;num must be positive nonzero int&quot;</span><span class="p">)</span>

        <span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">times</span></div>


<div class="viewcode-block" id="CxoTime.now">
<a class="viewcode-back" href="../../index.html#cxotime.cxotime.CxoTime.now">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">now</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">()</span></div>


    <span class="n">now</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="CxoTime.print_conversions">
<a class="viewcode-back" href="../../index.html#cxotime.cxotime.CxoTime.print_conversions">[docs]</a>
    <span class="k">def</span> <span class="nf">print_conversions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print a table of conversions to a standard set of formats.</span>

<span class="sd">        Example::</span>

<span class="sd">           &gt;&gt;&gt; from cxotime import CxoTime</span>
<span class="sd">           &gt;&gt;&gt; t = CxoTime(&#39;2010:001:00:00:00&#39;)</span>
<span class="sd">           &gt;&gt;&gt; t.print_conversions()</span>
<span class="sd">           local       2009 Thu Dec 31 07:00:00 PM EST</span>
<span class="sd">           iso_local   2009-12-31T19:00:00-05:00</span>
<span class="sd">           date        2010:001:00:00:00.000</span>
<span class="sd">           cxcsec      378691266.184</span>
<span class="sd">           decimalyear 2010.00000</span>
<span class="sd">           iso         2010-01-01 00:00:00.000</span>
<span class="sd">           unix        1262304000.000</span>

<span class="sd">        :param file: file-like, optional</span>
<span class="sd">            File-like object to write output (default=sys.stdout).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>

        <span class="n">formats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;cxcsec&quot;</span><span class="p">:</span> <span class="s2">&quot;.3f&quot;</span><span class="p">,</span>
            <span class="s2">&quot;decimalyear&quot;</span><span class="p">:</span> <span class="s2">&quot;.5f&quot;</span><span class="p">,</span>
            <span class="s2">&quot;unix&quot;</span><span class="p">:</span> <span class="s2">&quot;.3f&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">conversions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_conversions</span><span class="p">()</span>

        <span class="c1"># Format numerical values as strings with specified precision</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">fmt</span> <span class="ow">in</span> <span class="n">formats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">conversions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="n">conversions</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">fmt</span><span class="p">)</span>

        <span class="n">formats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">conversions</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">conversions</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([</span><span class="n">formats</span><span class="p">,</span> <span class="n">values</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">])</span>
        <span class="n">out</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s2">&quot;&lt;s&quot;</span>
        <span class="n">out</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s2">&quot;&lt;s&quot;</span>

        <span class="c1"># Remove the header and print</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">pformat_all</span><span class="p">()[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span></div>


<div class="viewcode-block" id="CxoTime.get_conversions">
<a class="viewcode-back" href="../../index.html#cxotime.cxotime.CxoTime.get_conversions">[docs]</a>
    <span class="k">def</span> <span class="nf">get_conversions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a dict of conversions to a standard set of formats.</span>

<span class="sd">        Example::</span>

<span class="sd">           &gt;&gt;&gt; from cxotime import CxoTime</span>
<span class="sd">           &gt;&gt;&gt; t = CxoTime(&#39;2010:001:00:00:00&#39;)</span>
<span class="sd">           &gt;&gt;&gt; t.get_conversions()</span>
<span class="sd">           {&#39;local&#39;: &#39;2009 Thu Dec 31 07:00:00 PM EST&#39;,</span>
<span class="sd">           &#39;iso_local&#39;: &#39;2009-12-31T19:00:00-05:00&#39;,</span>
<span class="sd">           &#39;date&#39;: &#39;2010:001:00:00:00.000&#39;,</span>
<span class="sd">           &#39;cxcsec&#39;: 378691266.184,</span>
<span class="sd">           &#39;decimalyear&#39;: 2010.0,</span>
<span class="sd">           &#39;iso&#39;: &#39;2010-01-01 00:00:00.000&#39;,</span>
<span class="sd">           &#39;unix&#39;: 1262304000.0}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timezone</span>

        <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">dt_local</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">out</span><span class="p">[</span><span class="s2">&quot;local&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt_local</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y </span><span class="si">%a</span><span class="s2"> %b </span><span class="si">%d</span><span class="s2"> %I:%M:%S %p %Z&quot;</span><span class="p">)</span>
        <span class="n">out</span><span class="p">[</span><span class="s2">&quot;iso_local&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt_local</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;cxcsec&quot;</span><span class="p">,</span> <span class="s2">&quot;decimalyear&quot;</span><span class="p">,</span> <span class="s2">&quot;iso&quot;</span><span class="p">,</span> <span class="s2">&quot;unix&quot;</span><span class="p">]:</span>
            <span class="n">out</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span></div>
</div>



<span class="n">TimeJD</span><span class="o">.</span><span class="n">convert_doc</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;input_name&quot;</span><span class="p">:</span> <span class="s2">&quot;jd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;descr_short&quot;</span><span class="p">:</span> <span class="s2">&quot;Julian Date&quot;</span><span class="p">,</span>
    <span class="s2">&quot;input_format&quot;</span><span class="p">:</span> <span class="s2">&quot;Julian Date (numeric)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;output_format&quot;</span><span class="p">:</span> <span class="s2">&quot;Julian Date (numeric)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;input_type&quot;</span><span class="p">:</span> <span class="s2">&quot;float, int, list, ndarray&quot;</span><span class="p">,</span>
    <span class="s2">&quot;output_type&quot;</span><span class="p">:</span> <span class="s2">&quot;float, ndarray[float]&quot;</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">class</span> <span class="nc">TimeSecs</span><span class="p">(</span><span class="n">TimeCxcSec</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Chandra X-ray Center seconds from 1998-01-01 00:00:00 TT.</span>

<span class="sd">    For example, 63072064.184 is midnight on January 1, 2000.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;secs&quot;</span>

    <span class="c1"># Documentation inputs for convert functions</span>
    <span class="n">convert_doc</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;input_name&quot;</span><span class="p">:</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;descr_short&quot;</span><span class="p">:</span> <span class="s2">&quot;CXC seconds&quot;</span><span class="p">,</span>
        <span class="s2">&quot;input_format&quot;</span><span class="p">:</span> <span class="s2">&quot;CXC seconds (numeric)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;output_format&quot;</span><span class="p">:</span> <span class="s2">&quot;CXC seconds (numeric)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;input_type&quot;</span><span class="p">:</span> <span class="s2">&quot;float, int, list, ndarray&quot;</span><span class="p">,</span>
        <span class="s2">&quot;output_type&quot;</span><span class="p">:</span> <span class="s2">&quot;float, ndarray[float]&quot;</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">class</span> <span class="nc">TimeDate</span><span class="p">(</span><span class="n">TimeYearDayTime</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Year, day-of-year and time as &quot;YYYY:DOY:HH:MM:SS.sss...&quot; in UTC.</span>

<span class="sd">    The day-of-year (DOY) goes from 001 to 365 (366 in leap years).</span>
<span class="sd">    For example, 2000:001:00:00:00.000 is midnight on January 1, 2000.</span>

<span class="sd">    Time value in this format is always UTC regardless of the time scale</span>
<span class="sd">    of the time object.  For example::</span>

<span class="sd">      &gt;&gt;&gt; t = CxoTime(&#39;2000-01-01&#39;, scale=&#39;tai&#39;)</span>
<span class="sd">      &gt;&gt;&gt; t.iso</span>
<span class="sd">      &#39;2000-01-01 00:00:00.000&#39;</span>
<span class="sd">      &gt;&gt;&gt; t.date</span>
<span class="sd">      &#39;1999:365:23:59:28.000&#39;</span>

<span class="sd">    The allowed subformats are:</span>

<span class="sd">    - &#39;date_hms&#39;: date + hours, mins, secs (and optional fractional secs)</span>
<span class="sd">    - &#39;date_hm&#39;: date + hours, mins</span>
<span class="sd">    - &#39;date&#39;: date</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;date&quot;</span>

    <span class="c1"># Documentation inputs for convert functions</span>
    <span class="n">convert_doc</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;input_name&quot;</span><span class="p">:</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span>
        <span class="s2">&quot;descr_short&quot;</span><span class="p">:</span> <span class="s2">&quot;Date (Year, day-of-year, time)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;input_format&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    - YYYY:DDD:HH:MM:SS.sss</span>
<span class="s2">    - YYYY:DDD:HH:MM:SS</span>
<span class="s2">    - YYYY:DDD:HH:MM</span>
<span class="s2">    - YYYY:DDD&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;output_format&quot;</span><span class="p">:</span> <span class="s2">&quot;YYYY:DDD:HH:MM:SS.sss&quot;</span><span class="p">,</span>
        <span class="s2">&quot;input_type&quot;</span><span class="p">:</span> <span class="s2">&quot;str, bytes, float, list, ndarray&quot;</span><span class="p">,</span>
        <span class="s2">&quot;output_type&quot;</span><span class="p">:</span> <span class="s2">&quot;str, ndarray[str]&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">to_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;utc&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">parent</span><span class="o">.</span><span class="n">utc</span><span class="o">.</span><span class="n">_time</span><span class="o">.</span><span class="n">value</span>

    <span class="n">value</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">to_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_jds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse the time strings contained in val1 and set jd1, jd2&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">val2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot supply val2 for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> format&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jd1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">jd2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_jds_fast</span><span class="p">(</span><span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TimeFracYear</span><span class="p">(</span><span class="n">TimeDecimalYear</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Time as a decimal year.</span>

<span class="sd">    Integer values corresponding to midnight of the first day of each year.  For example</span>
<span class="sd">    2000.5 corresponds to the ISO time &#39;2000-07-02 00:00:00&#39;.</span>

<span class="sd">    Time value is always in UTC regardless of time object scale.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;frac_year&quot;</span>

    <span class="k">def</span> <span class="nf">to_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;utc&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">parent</span><span class="o">.</span><span class="n">utc</span><span class="o">.</span><span class="n">_time</span><span class="o">.</span><span class="n">value</span>

    <span class="n">value</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">to_value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TimeGreta</span><span class="p">(</span><span class="n">TimeDate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Date as string in format &#39;YYYYDDD.hhmmsssss&#39;.</span>

<span class="sd">    Here sssss is the number of millisec.</span>

<span class="sd">    This can be input as a float, integer or string, but the output is always string.</span>

<span class="sd">    Time value is always in UTC regardless of time object scale.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;greta&quot;</span>

    <span class="c1"># Documentation inputs for convert functions</span>
    <span class="n">convert_doc</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;input_name&quot;</span><span class="p">:</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span>
        <span class="s2">&quot;descr_short&quot;</span><span class="p">:</span> <span class="s2">&quot;GRETA date&quot;</span><span class="p">,</span>
        <span class="s2">&quot;input_format&quot;</span><span class="p">:</span> <span class="s2">&quot;YYYYDDD.HHMMSSsss (str or float)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;output_format&quot;</span><span class="p">:</span> <span class="s2">&quot;YYYYDDD.HHMMSSsss (str)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;input_type&quot;</span><span class="p">:</span> <span class="s2">&quot;str, bytes, float, list, np.ndarray&quot;</span><span class="p">,</span>
        <span class="s2">&quot;output_type&quot;</span><span class="p">:</span> <span class="s2">&quot;str, np.ndarray[str]&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">subfmts</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;date_hms&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y%j%H%M%S&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{year:d}{yday:03d}{hour:02d}{min:02d}{sec:02d}</span><span class="s2">&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Define positions and starting delimiter for year, month, day, hour,</span>
    <span class="c1"># minute, seconds components of an ISO time. This is used by the fast</span>
    <span class="c1"># C-parser parse_ymdhms_times()</span>
    <span class="c1">#</span>
    <span class="c1">#  &quot;2000123.131415678&quot;</span>
    <span class="c1">#   01234567890123456</span>
    <span class="c1">#   yyyyddd.hhmmssfff</span>
    <span class="c1"># Parsed as (&#39;yyyy&#39;, &#39;ddd&#39;, &#39;.hh&#39;, &#39;mm&#39;, &#39;ss&#39;, &#39;fff&#39;)</span>
    <span class="c1">#</span>
    <span class="c1"># delims: character at corresponding `starts` position (0 =&gt; no character)</span>
    <span class="c1"># starts: position where component starts (including delimiter if present)</span>
    <span class="c1"># stops: position where component ends (-1 =&gt; continue to end of string)</span>

    <span class="c1"># Before: yr mon  doy     hour      minute    second    frac</span>

    <span class="n">fast_parser_pars</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;delims&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">ord</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s2">&quot;starts&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span>
        <span class="s2">&quot;stops&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
        <span class="c1"># Break before:  y  m  d  h  m  s  f</span>
        <span class="s2">&quot;break_allowed&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="s2">&quot;has_day_of_year&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_check_val_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">val2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot supply val2 for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> format&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">val1</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Input values for </span><span class="si">{0}</span><span class="s2"> class must be string or number&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">val1</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">):</span>
            <span class="n">val1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">{:.9f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val1</span><span class="o">.</span><span class="n">flat</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">val1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">val1</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">to_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;utc&quot;</span><span class="p">:</span>
            <span class="n">out1</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out1</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">utc</span><span class="o">.</span><span class="n">_time</span><span class="o">.</span><span class="n">value</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">14</span><span class="p">:]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">out1</span><span class="o">.</span><span class="n">flat</span><span class="p">])</span>
        <span class="n">out</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">out1</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="n">value</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">to_value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TimeMaude</span><span class="p">(</span><span class="n">TimeDate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Date as a 64-bit integer in format YYYYDDDHHMMSSsss.</span>

<span class="sd">    Here sss is number of milliseconds.</span>

<span class="sd">    This can be input as an integer or string, but the output is always integer.</span>

<span class="sd">    Time value is always in UTC regardless of time object scale.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;maude&quot;</span>
    <span class="n">convert_doc</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;input_name&quot;</span><span class="p">:</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span>
        <span class="s2">&quot;descr_short&quot;</span><span class="p">:</span> <span class="s2">&quot;MAUDE date&quot;</span><span class="p">,</span>
        <span class="s2">&quot;input_format&quot;</span><span class="p">:</span> <span class="s2">&quot;YYYYDDDHHMMSSsss (str or int)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;output_format&quot;</span><span class="p">:</span> <span class="s2">&quot;YYYYDDD.HHMMSSsss (int)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;input_type&quot;</span><span class="p">:</span> <span class="s2">&quot;str, bytes, int, list, ndarray&quot;</span><span class="p">,</span>
        <span class="s2">&quot;output_type&quot;</span><span class="p">:</span> <span class="s2">&quot;int, ndarray[int]&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">subfmts</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;date_hms&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y%j%H%M%S&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{year:d}{yday:03d}{hour:02d}{min:02d}{sec:02d}</span><span class="s2">&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Define positions and starting delimiter for year, month, day, hour,</span>
    <span class="c1"># minute, seconds components of an ISO time. This is used by the fast</span>
    <span class="c1"># C-parser parse_ymdhms_times()</span>
    <span class="c1">#</span>
    <span class="c1">#  &quot;2000123131415678&quot;</span>
    <span class="c1">#   0123456789012345</span>
    <span class="c1">#   yyyydddhhmmssfff</span>
    <span class="c1"># Parsed as (&#39;yyyy&#39;, &#39;ddd&#39;, &#39;hh&#39;, &#39;mm&#39;, &#39;ss&#39;, &#39;fff&#39;)</span>
    <span class="c1">#</span>
    <span class="c1"># delims: character at corresponding `starts` position (0 =&gt; no character)</span>
    <span class="c1"># starts: position where component starts (including delimiter if present)</span>
    <span class="c1"># stops: position where component ends (-1 =&gt; continue to end of string)</span>

    <span class="c1"># Before: yr mon  doy     hour      minute    second    frac</span>
    <span class="n">fast_parser_pars</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;use_fast_parser&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;delims&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s2">&quot;starts&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span>
        <span class="s2">&quot;stops&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
        <span class="c1"># Break before:  y  m  d  h  m  s  f,</span>
        <span class="s2">&quot;break_allowed&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="s2">&quot;has_day_of_year&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_check_val_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">val2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot supply val2 for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> format&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">val1</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Input values for </span><span class="si">{0}</span><span class="s2"> class must be string or int&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">val1</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;i&quot;</span><span class="p">:</span>
            <span class="n">val1</span> <span class="o">=</span> <span class="n">val1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">val1</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">to_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;utc&quot;</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">utc</span><span class="o">.</span><span class="n">_time</span><span class="o">.</span><span class="n">value</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[:</span><span class="mi">13</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">14</span><span class="p">:]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">flat</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;i8&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span>

    <span class="n">value</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">to_value</span><span class="p">)</span>


<div class="viewcode-block" id="CxoTimeDescriptor">
<a class="viewcode-back" href="../../index.html#cxotime.cxotime.CxoTimeDescriptor">[docs]</a>
<span class="k">class</span> <span class="nc">CxoTimeDescriptor</span><span class="p">(</span><span class="n">TypedDescriptor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Descriptor for an attribute that is CxoTime (in date format) or None if not set.</span>

<span class="sd">    This allows setting the attribute with any ``CxoTimeLike`` value.</span>

<span class="sd">    Note that setting this descriptor to ``None`` will set the attribute to ``None``,</span>
<span class="sd">    which is different than ``CxoTime(None)`` which returns the current time.</span>

<span class="sd">    To set an attribute to the current time, use ``CxoTime.NOW``, either as the default</span>
<span class="sd">    or when setting the attribute.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    default : CxoTimeLike, optional</span>
<span class="sd">        Default value for the attribute which is provide to the ``CxoTime`` constructor.</span>
<span class="sd">        If not specified or ``None``, the default for the attribute is ``None``.</span>
<span class="sd">    required : bool, optional</span>
<span class="sd">        If ``True``, the attribute is required to be set explicitly when the object is</span>
<span class="sd">        created. If ``False`` the default value is used if the attribute is not set.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from dataclasses import dataclass</span>
<span class="sd">    &gt;&gt;&gt; from cxotime import CxoTime, CxoTimeDescriptor</span>
<span class="sd">    &gt;&gt;&gt; @dataclass</span>
<span class="sd">    ... class MyClass:</span>
<span class="sd">    ...     start: CxoTime | None = CxoTimeDescriptor()</span>
<span class="sd">    ...     stop: CxoTime = CxoTimeDescriptor(default=CxoTime.NOW)</span>
<span class="sd">    ...</span>
<span class="sd">    &gt;&gt;&gt; obj = MyClass(&quot;2023:100&quot;)  # Example run at 2024:006:12:02:35</span>
<span class="sd">    &gt;&gt;&gt; obj.start</span>
<span class="sd">    &lt;CxoTime object: scale=&#39;utc&#39; format=&#39;date&#39; value=2023:100:00:00:00.000&gt;</span>
<span class="sd">    &gt;&gt;&gt; obj.stop</span>
<span class="sd">    &lt;CxoTime object: scale=&#39;utc&#39; format=&#39;date&#39; value=2024:006:12:02:35.000&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">cls</span> <span class="o">=</span> <span class="n">CxoTime</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


<form action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2015, Tom Aldcroft.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.2.6. &nbsp;
  </p>
</footer>
  </body>
</html>